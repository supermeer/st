<!--pages/chat-list/index.wxml-->
<view class="chat-page-container">
  <!-- 自定义导航栏 -->
  <custom-nav
    class="custom-nav"
    show-back="{{false}}"
    show-left-logo="{{false}}"
    show-home="{{false}}"
    transparent="{{true}}"
  >
    <t-image slot="center" src="/static/chat/chat_nav.jpg" width="112rpx" height="44rpx" />
  </custom-nav>

  <!-- 下拉刷新 + 聊天列表 -->
  <t-pull-down-refresh
    value="{{refreshing}}"
    loadingProps="{{loadingProps}}"
    loadingTexts="{{['下拉刷新', '松手刷新', '正在刷新', '刷新完成']}}"
    bind:refresh="onRefresh"
    bind:timeout="onTimeout"
    disabled="{{!isScrollTop}}"
  >
    <scroll-view 
      class="chat-content" 
      scroll-y
      bindscroll="onScroll"
      style="height: {{scrollHeight}};"
    >
      <!-- 聊天列表 -->
      <view class="chat-list" wx:if="{{chatList.length > 0}}">
        <view class="chat-item-wrapper" wx:for="{{chatList}}" wx:key="id">
          <van-swipe-cell
            id="swipeCell-{{item.id}}"
            class="chat-swipe-cell"
            right-width="{{120}}"
            async-close
            data-id="{{item.id}}"
          >
            <view
              class="chat-item {{item.isTop ? 'top-chat-item' : ''}}"
              data-id="{{item.id}}"
              bindtap="onChatItemClick"
            >
              <view class="chat-avatar">
                <image src="{{item.avatar || '/static/chat/default-avatar.png'}}" mode="aspectFill" />
              </view>
              <view class="chat-info">
                <view class="chat-header">
                  <view class="chat-name">{{item.name}}</view>
                  <view class="chat-time">{{item.timeText}}</view>
                </view>
                <view class="chat-last-msg">{{item.lastMessage}}</view>
              </view>
            </view>
            <!-- 右侧滑出删除按钮 -->
            <view slot="right" class="swipe-actions">
              <view class="swipe-action top-btn" catch:tap="onTopChat" data-id="{{item.id}}">
                <t-icon name="backtop" size="18px" color="#fff" />
                置顶
              </view>
              <view class="swipe-action delete-btn" catch:tap="onDeleteChat" data-id="{{item.id}}">
                <t-icon name="delete" size="18px" color="#ee5a6f" />
                删除
              </view>
            </view>
          </van-swipe-cell>
          <view class="chat-item-line" wx:if="{{index < chatList.length - 1}}" />
        </view>
        <view style="height: calc({{pageInfo.safeAreaBottom}}px + {{pageInfo.tabbarHeight}}rpx + 10px);"></view>
      </view>

      <!-- 空状态 -->
      <view class="empty-state" wx:else>
        <t-icon name="unhappy" size="100rpx" color="#ccc" />
        <text class="empty-text">暂无聊天记录</text>
      </view>
    </scroll-view>
  </t-pull-down-refresh>

</view>

<t-toast id="t-toast" />
<t-dialog id="t-dialog" />
<tip-dialog id="tip-dialog" />

