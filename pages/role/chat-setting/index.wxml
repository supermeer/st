<view class="chat-setting-page">
  <!-- 固定背景图 -->
  <image class="page-bg" src="{{showBG ? currentBg : ''}}" mode="aspectFill"></image>
  
  <!-- 固定顶部导航栏 -->
  <custom-nav title="" showBack="{{true}}" showHome="{{false}}" transparent="{{true}}" />
  
  <!-- 固定角色信息卡片 -->
  <view class="chat-header blur-glass" style="top: {{ pageInfo.navHeight }}px">
    <image class="chat-avatar" src="{{currentBg}}" mode="aspectFill"></image>
    <view class="chat-name">{{roleInfo.name}}</view>
  </view>

  <!-- 可滚动内容区域 -->
  <scroll-view
    class="scroll-content"
    scroll-y
    enhanced
    show-scrollbar="{{false}}"
    style="height: calc(100% - {{ pageInfo.navHeight}}px);"
  >
    
    <!-- 设置内容 -->
    <view class="settings-content" style="padding-bottom: {{ pageInfo.safeAreaBottom + 40}}px;">
      
      <!-- 今日对话 -->
      <!-- <view class="setting-section blur-glass">
        <view class="section-header">
          <view class="section-title">今日对话</view>
          <view class="upgrade-btn yellow-btn-text" bindtap="onUpgradeLimit">提升上限</view>
        </view>
        <view class="chat-quota">
          <text class="quota-used">{{todayChat.used}}</text>
          <text class="quota-separator"> / </text>
          <text class="quota-total">{{todayChat.total}}</text>
        </view>
      </view> -->

      <view class="setting-section blur-glass">
        <view class="section-header">
          <view class="section-title">
            对话模型
          </view>
          <view class="setting-section-link" bindtap="onModelSelect">
            <view class="new-tip">上新模型啦！限时优惠哦！<view wx:if="{{showModelDot}}" class="new-tip-dot" /></view>
            <t-icon name="chevron-right" size="40rpx" color="rgba(255,255,255,0.6)" />
          </view>
        </view>
        <model-display 
          currentValue="{{currentModel.id}}"
          modelOptions="{{modelList}}"
        />
      </view>

      <!-- 智能体记忆力 -->
      <view class="setting-section blur-glass">
        <view class="section-header">
          <view class="section-title">
            智能体记忆力
            <t-icon name="info-circle" size="36rpx" color="#ffffff" catchtap="onMemoryDesc" />
          </view>
          <view class="setting-section-link" bindtap="onMemoryStrength">
            <text class="yellow-btn-text">记忆加强</text>
            <t-icon name="chevron-right" size="40rpx" color="rgba(255,255,255,0.6)" />
          </view>
        </view>
        
        <!-- 一般记忆 -->
        <memory-display 
          currentMemory="{{plotInfo.memoryCount}}"
          memoryOptions="{{memoryOptions}}"
        />
      </view>

      <!-- 其他功能设置 -->
      <view class="setting-section blur-glass">
        <view class="section-title">其他功能设置</view>
        
        <!-- 聊天背景 -->
        <view class="setting-item" bindtap="onSelectBackground">
          <view class="setting-label">聊天背景</view>
          <view class="setting-action">
            <t-icon name="chevron-right" size="40rpx" color="rgba(255,255,255,0.6)" />
          </view>
        </view>

        <view class="setting-item">
          <view class="setting-label">始终全屏对话</view>
          <view class="setting-action">
            <t-switch
              class="setting-switch"
              value="{{keepFullScreen}}"
              bindchange="onSwitchChange"
            />
          </view>
        </view>

        <!-- 对话字体颜色 -->
        <view class="setting-item" bindtap="onGradientPicker">
          <view class="setting-label">对话字体颜色</view>
          <view class="setting-action">
            <text class="setting-value">{{quoteGradientName}}</text>
            <t-icon name="chevron-right" size="40rpx" color="rgba(255,255,255,0.6)" />
          </view>
        </view>
      </view>

    </view>
    
  </scroll-view>

  <!-- 背景选择弹窗 -->
  <background-sheet id="backgroundSheet" />
  
  <!-- 记忆加强弹窗 -->
  <memory-sheet id="memorySheet" />

  <!-- 模型选择弹窗 -->
  <model-sheet id="modelSheet" />

  <!-- 记忆力说明遮罩层 -->
  <memory-desc-overlay show="{{ showMemoryDescOverlay }}" bind:close="onCloseMemoryDesc" />
</view>

<image-uploader
  visible="{{showUploader}}"
  bind:success="onUploadSuccess"
  bind:fail="onUploadFail"
  bind:cancel="onUploadCancel"
  isPublic="true"
/>
